---
title: 关于chisel的一些想法
date: 2022-08-16 23:46:24
updated: 2022-08-24 23:46:24
pinned: true
---

旋风式的过了一遍Chisel-BootCamp以后，再结合香山团队成员以前对他们芯片敏捷开发流程的报告内容，我对Chisel本身也有了一些和以前不一样的想法。

首先我觉得不能神话Chisel。Chisel本身是UC Berkeley大学的Krste Asanovic教授团队在开发RISC-V过程中为了缩短测试反馈周期而采用的一个「副产品」，是一个工具，应该归类于基础设施。单独某项工具本身我觉得是比较难改变已有生态的，能够造成影响的是工具背后体现的那一套解决问题的机制，比如SVN和Git等工具与它们对版本控制问题解决的机制。

Chisel实现上则是Scala的一个库，既然是库那说白了就是一堆类和方法等的集合，至于说为什么选Scala来实现这个库，那应该和Scala本身的一些特性有关系，我对它不怎么了解，这个不太好直接下结论。但是，Chisel内部又有一些库，这就带来了第三方生态，这是很重要的。

类和方法是典型的以面向对象的思想对现实世界进行的抽象，那从这个角度上，Chisel必然要进行某种「转译」，「转译」成一种抽象程度较低但同时人还能阅读的HDL，实际上这个中间层我觉得就是verilog。这就像是C/C++这类高级语言一样，它们作为对计算机系统的高层次抽象，本身失去了对计算机系统进行细粒度操作的能力，换句话说就是抽得太高了，高到中间有一截真空，要想对这截真空做操作那只能再插进去一个中间层。高级语言上，这个中间层就是汇编。

其次就是，Chisel本身也体现了一些业界探索的方向。「敏捷开发」这其实不是一个新概念，软件工程上很早就有了，张小龙在某年的微信之夜上还特地提出来说推荐大家试着采用。我个人理解「敏捷开发」的核心是「反馈周期极短」，也就是说某项功能或者某个修改具体落实到生产环境中效果如何很快就能有反馈，越快越好，快速迭代，尽早评估。软件编译还好，几个小时堪堪能接受，但硬件的流片等流程动辄几个月，成本还极高，这周期根本不符合现在的趋势。Chisel也好，香山团队也好，背后的这一套「敏捷开发流程」我觉得至少在数字IC领域是进行了一次很有价值的探索。从这个角度而言，Chisel的成长就很有意义，它体现的是未来方向，而既然是未来，那就必须允许探索。香山团队和开芯院都是在做一些「不一样的事」。

最后，浏览完Chisel-BootCamp以后，我几乎没什么用Chisel实现一些较为复杂的硬件结构的想法，像是雾里看花水中望月，朦朦胧胧的一种感觉，落实到细节上很难抓得住。

为什么说这世界自有其运行规律？也就在今天，在我有了这种朦朦胧胧的感觉后，极其偶然地，我读到了一篇文章，是已故院士陈希孺先生《高等数理统计学》的序言，我选摘抄录如下：

*笔者在学生时代及其后的几年中，对做习题未给予足够重视. 当时误认为做题费时间，不增长新知识，不如多读些书，占得实地. 以后试做研究工作，就日渐感到其不良后果，表现在碰到问题办法少，容易钻死胡同，克服难点的能力弱，以致对自己缺乏信心. 对许多方法，都似雾里看花，似曾识面，而不能切实掌握和灵活运用. 有如十八般兵器，样样都见过，但拿到手里，就使不动或很笨拙. 欲以此克敌制胜，自难有成. 以后稍明白了这一点，做了些亡羊之补，终究晚了一些，所谓“困而学之，又其次也”. “熟能生巧”，前人的经验不诬. 而要达到“熟”，舍大量做题，无他捷径可循. 几十年来，审了大量的杂志稿件，每见某些工作，由于未经深思，为一个并不难克服之点加上了若干不必需的繁复条件，从而使整个工作流于肤浅. 这根子，大略也在于早先在习题上下的工夫不够，以致难以产生别出心裁的想法.*

这不由得让我想起我之前一直对计算机系统中的一些最基础的概念理解很不到位，比如「字」这类最基础的概念，我经常是定义反复翻看到都能熟练挂到嘴边了，但还是不能真正理解。还有就是一些数字电路的器件，简单的加法器乘法器闭上眼睛可以很清晰地走通数据通路，但当整个电路一旦略微复杂起来，尤其是进位信号和一些使能端嵌套时，脑子里就乱了，觉得这堆东西简直是混沌的。再有就是一些平时没怎么用过的编程语言了，看能看懂，写也能写一些一般复杂规模的程序，但是一旦涉及一些低级数据类型的操作时，就明显会感觉很吃力，这可能和我没学过编译原理有关，也和我对计算机系统的理解不够深刻有关。不过还好，最近一直在做一些和计算机系统相关的内容，所以这方面提升很快。

今天看到院士在我出生之前某个除夕夜写下的这篇文章，感慨万千。

我以前一直觉得准备考研是在拖累我，它占用我的大量时间，让我不能全身心投入到我想做的那些项目中去。但是，从另一个角度来说，考研本身也是另一种学习的方式，而且或许是解决我已有问题的很合适、很有效的一种方式。

能够沉下心来专注做那些理论而不被其他事物——不论是自己感兴趣的、不感兴趣的，甚至是自己心理上营造的障碍——干扰，这本身也是一种能力。

我在几个月前因为很偶然的机会，在某个项目群里看到了「一生一芯」，发现自己一直想做的、感兴趣的方向叫「Computer Architecture」，并在这几个月里在这个方向上进行了一番浅浅的尝试，也正是由此导致了我最近的焦虑甚至报复性情绪。现在，又是在这样一个特殊的状态和时间节点上，我又因为偶然的机会看到了如此严谨治学的院士的这篇文章，被一语点醒。世界就是如此奇妙。

我有信心未来会越来越好。

***

几天前，忽然觉得自己的本科生涯很失败，没能做一些让自己觉得可以拿得出手的东西，就在深夜发泄似的写下了下面这些话。因为情绪可能比较激动，所以出现了一些不好的字眼（保留这些不好的语言是想体现我当时的情绪）。

![截图](images/Shot.jpg)

因而有了再最后「抖擞一下精神」的想法，想最后再花一些时间，迅速地做一个还说得过去的东西。简单考虑了一下，决定做一个基于CSAPP 3e里的Y86-64指令集的CPU，首先因为这个指令集很简单，但五脏俱全，同时书中也对实现过程有很详细的讲解，SEQ和流水线不同难度的等级也都可以选择，而且如果还有时间的话，还可以扩展用Chisel来实现或者再实现一个类似于NEMU的指令集仿真器。

> 做完了，[内容见此](https://wolfyzhang-github.github.io/2022/08/16/%E5%9F%BA%E4%BA%8EYEMU%E6%80%9D%E8%B7%AF%E7%9A%84Y86-64%E6%8C%87%E4%BB%A4%E9%9B%86%E4%BB%BF%E7%9C%9F%E5%99%A8/)。
>
> 这两天又看到一个直博的体系结构方向大佬的简历，他是「一生一芯」的助教，还在首届「一生一芯」技术论坛上做了分享。比起他们来我的简历甚至可以算上是没任何东西。
>
> 不过，我觉得还是不要自卑，我基础差就沉下心好好做些工作，慢慢丰富简历。
>
> 我慢慢来吧。
>
> 2022/08/24