---
title: 基于YEMU思路的Y86-64指令集仿真器
date: 2022-08-16 11:09:14
updated:
twitter:
draft:
pinned: true
---

书接上回，在[上次决定要「抖擞一下精神」](https://wolfyzhang-github.github.io/2022/08/16/%E5%AF%B9Chisel%E6%B5%85%E5%B0%9D%E8%BE%84%E6%AD%A2%E5%90%8E%E7%9A%84%E6%83%B3%E6%B3%95/)后，现在终于可以小小展示一下成果了：

![shot](images/shot.png)

![shot](images/shot_1.png)

可以看到一个简单的「流水账」指令执行模拟程序，从传入的ASCII编码的二进制文件中读取位级指令，然后依次执行fetch、decode、execute、read memory、write memory和update pc等流程，一套流程走完了，这一条指令也就执行完了。出于在时间安排上的考虑，我选了CSAPP 3e中为教学设计的Y86-64指令集，它足够简单，同时又不至于太过简单，一些常用的指令元素基本都有涉及，关于Y86-64的具体内容这里就不再多言。

我想聊聊我在实际实现它过程中的一些经历和想法。

## （一）文本文件和二进制文件

文本文件是数字，二进制文件也是数字，二者的不同之处在于，前者是有映射关系的数字，你在屏幕上看到的数字369，实际上在内存中是另外一个编码映射过的值；后者则数字就是数字本身，不存在字符编码那样的映射关系。或者说，你在屏幕上操作369，但实际上在内存里却是另外的一个数，而你获取到某个内存单元地址，或者读取到某个寄存器的值，那这个数字就是这个数字，没有其他映射值。

## （二）编程问题归结到最后还是算法问题

位操作，数组操作，最后都是操作数据之间的逻辑关系即数据结构，而这也就是算法本身。

## （三）规范化的工程思想

单元测试、CI，等等，实际使用起来都是很有用的。

## （四）基础设施与IC敏捷开发

toolchains是基础设施，香山现在背后的那套IC敏捷开发机制也是基础设置。
